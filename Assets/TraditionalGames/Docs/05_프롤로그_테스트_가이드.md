# 프롤로그 테스트 가이드

## 목표
프롤로그 영역에서 보따리 트리거가 정상 동작하는지 테스트

> **참고**: 이 가이드는 게임의 첫 번째 시작점입니다. 게임은 프롤로그(Area_00_Prologue)에서 바로 시작됩니다.

## 1. Hierarchy 구조 생성

Unity에서 아래 구조로 빈 GameObject들을 생성하세요:

```
TraditionalGames (Scene Root)
├── Managers/
│   ├── GameFlowManager     [VivenLuaBehaviour]
│   ├── StageManager        [VivenLuaBehaviour]
│   └── AudioManager        [VivenLuaBehaviour]
├── Areas/
│   ├── Area_00_Prologue/   [시작 영역 - 활성화 상태]
│   │   ├── Environment/    [3D 모델 또는 임시 Plane]
│   │   ├── Bottari/        [보따리 오브젝트]
│   │   │   ├── BottariMesh     [Cube 또는 3D 모델]
│   │   │   ├── TriggerZone     [Box Collider, Is Trigger]
│   │   │   └── OpenUI          [Canvas 또는 3D Text]
│   │   └── SpawnPoint      [Empty - Transform만]
│   ├── Area_01_Timeleap/   [비활성화 상태]
│   │   └── SpawnPoint
│   ├── Area_02_Pandol/     [비활성화 상태]
│   │   └── SpawnPoint
│   ├── Area_03_Biseok/     [비활성화 상태]
│   │   └── SpawnPoint
│   └── Area_04_Ending/     [비활성화 상태]
│       └── SpawnPoint
└── Player/
    └── XR Origin (VIVEN 표준)
```

### 영역 초기 상태
| 영역 | 초기 Active | 설명 |
|------|-------------|------|
| Area_00_Prologue | ✅ Active | 시작 영역 (현대 경복궁) |
| Area_01_Timeleap | ❌ Inactive | 보따리 열기 후 전환 |
| Area_02_Pandol | ❌ Inactive | 타임리프 후 전환 |
| Area_03_Biseok | ❌ Inactive | 판돌 클리어 후 전환 |
| Area_04_Ending | ❌ Inactive | 비석치기 클리어 후 전환 |

## 2. 컴포넌트 설정

### 2.1 GameFlowManager 설정

**GameObject**: `Managers/GameFlowManager`

| 컴포넌트 | 설정 |
|----------|------|
| VObject | objectId: 자동생성 |
| VivenLuaBehaviour | Script: GameFlowManager |

**Injection 변수**:
| 변수명 | 연결 대상 |
|--------|-----------|
| area00Prologue | Areas/Area_00_Prologue |
| area01Timeleap | Areas/Area_01_Timeleap |
| area02Pandol | Areas/Area_02_Pandol |
| area03Biseok | Areas/Area_03_Biseok |
| area04Ending | Areas/Area_04_Ending |
| prologueSpawnPointObject | Areas/Area_00_Prologue/SpawnPoint (GameObject) |
| timeleapSpawnPointObject | Areas/Area_01_Timeleap/SpawnPoint (GameObject) |
| pandolSpawnPointObject | Areas/Area_02_Pandol/SpawnPoint (GameObject) |
| biseokSpawnPointObject | Areas/Area_03_Biseok/SpawnPoint (GameObject) |
| endingSpawnPointObject | Areas/Area_04_Ending/SpawnPoint (GameObject) |
| fadeTransitionTime | 1.0 |

> **중요**: SpawnPoint는 Transform이 아닌 **GameObject**를 연결합니다. 스크립트에서 `.transform`을 추출합니다.

### 2.2 StageManager 설정

**GameObject**: `Managers/StageManager`

| 변수명 | 연결 대상 |
|--------|-----------|
| gameFlowManagerName | "GameFlowManager" (문자열) |
| subtitleCanvas | (선택) 자막 UI Canvas |
| subtitleText | (선택) 자막 Text 컴포넌트 |

### 2.3 AudioManager 설정

**GameObject**: `Managers/AudioManager`

| 컴포넌트 | 설정 |
|----------|------|
| AudioSource (BGM) | Loop: true, PlayOnAwake: false |
| AudioSource (SFX) | Loop: false, PlayOnAwake: false |

| 변수명 | 연결 대상 |
|--------|-----------|
| bgmSource | 자신의 첫 번째 AudioSource |
| sfxSource | 자신의 두 번째 AudioSource |

### 2.4 Bottari (보따리) 설정

**GameObject**: `Areas/Area_00_Prologue/Bottari`

| 컴포넌트 | 설정 |
|----------|------|
| VObject | objectId: 자동생성 |
| VivenLuaBehaviour | Script: BottariTrigger |

**자식 오브젝트**:

1. **BottariMesh**
   - 임시: Cube (Scale: 0.5, 0.3, 0.5)
   - 또는 실제 보따리 3D 모델

2. **TriggerZone**
   - Box Collider: Is Trigger = true
   - Size: (2, 2, 2) - 플레이어 감지 범위

3. **OpenUI** (카운트다운 UI)
   - World Space Canvas
   - TMP_Text 컴포넌트 (자식에 포함)
   - 카운트다운 숫자 표시용 (5, 4, 3, 2, 1)

**Injection 변수**:
| 변수명 | 연결 대상 | 필수 |
|--------|-----------|------|
| gameFlowManagerName | "GameFlowManager" (문자열, 기본값) | 선택 |
| openUIObject | Bottari/OpenUI (TMP_Text 포함) | 선택 |
| narrationAudio | AudioSource (나레이션) | 선택 |
| sparkleParticle | ParticleSystem (반짝임 효과) | 선택 |
| openSound | AudioSource (열기 효과음) | 선택 |
| narrationDelay | 나레이션 지연 시간 (기본: 1.0초) | 선택 |
| bottariAnimator | Animator (열기 애니메이션) | 선택 |
| countdownStart | 카운트다운 시작 숫자 (기본: 5) | 선택 |

> **참고**: 모든 변수는 NullableInject 패턴을 사용하여 선택적입니다.

## 3. 플레이어 감지 설정

> **중요**: BottariTrigger는 Player 태그가 아닌 **VR 컨트롤러/손 이름 기반**으로 감지합니다.

감지되는 오브젝트 이름:
- `Grabber` (GrabberPC, Left Grabber 등)
- `Placer` (PlacerPC 등)
- `Interactor` (RIIO Left Interactor XR 등)
- `Hand` (손 추적 모드)
- `CharacterController`
- `Player` 태그 (백업)

## 4. 테스트 절차

### 4.1 기본 동작 테스트

1. **Play 모드 시작**
   - 콘솔에서 `[GameFlowManager] Initialized` 로그 확인
   - 콘솔에서 `[GameFlowManager] Prologue started - waiting for bottari trigger` 로그 확인
   - 콘솔에서 `[BottariTrigger] Initialized` 로그 확인
   - 프롤로그 영역(Area_00_Prologue)만 활성화되어 있는지 확인

2. **보따리 접근 (자동 카운트다운)**
   - VR 컨트롤러를 보따리 TriggerZone에 진입
   - 콘솔에서 `[BottariTrigger] Player entered trigger zone: [오브젝트명]` 로그 확인
   - OpenUI가 활성화되고 카운트다운 시작 (5, 4, 3, 2, 1)
   - 콘솔에서 `[BottariTrigger] Starting countdown...` 로그 확인
   - 콘솔에서 `[BottariTrigger] Countdown: 5` ~ `Countdown: 1` 로그 확인

3. **타임리프 전환**
   - 카운트다운 완료 후 자동으로 타임리프 전환
   - 콘솔에서 `[BottariTrigger] Countdown complete! Opening bottari...` 로그 확인
   - 콘솔에서 `[BottariTrigger] Bottari opened!` 로그 확인
   - Area_01_Timeleap으로 전환되는지 확인

### 4.2 디버그 테스트 (Inspector에서)

VivenLuaBehaviour 컴포넌트에서 직접 함수 호출:
- `BottariTrigger.StartCountdown()` 호출하여 카운트다운 강제 시작
- `BottariTrigger.OnOpenBottari()` 호출하여 즉시 전환

## 5. 문제 해결

### "th object is missing (nullable)" 로그
- 정상 동작입니다. NullableInject 패턴을 사용하므로 선택적 변수는 연결하지 않아도 됩니다.
- 필요한 기능이 있다면 해당 번호의 변수를 Inspector에서 연결하세요.

### "th object is missing" 오류 (assert 실패)
- checkInject로 정의된 필수 변수가 연결되지 않음
- 해당 번호의 변수를 확인하고 올바른 오브젝트 연결

### 전환이 안 됨
- GameFlowManager의 Area 오브젝트들이 올바르게 연결되었는지 확인
- **SpawnPoint는 GameObject를 연결** (Transform 아님)
  - `prologueSpawnPointObject`, `timeleapSpawnPointObject` 등
  - 스크립트에서 `.transform`을 추출합니다

### 트리거가 동작 안 함
- TriggerZone의 Collider가 Is Trigger = true인지 확인
- **VR 컨트롤러가 감지되는지 확인** (이름에 Grabber, Placer, Interactor, Hand 포함)
- Rigidbody가 플레이어 또는 트리거 중 하나에 있는지 확인
- 콘솔에서 `[BottariTrigger] Player entered trigger zone` 로그 확인

### 카운트다운 UI가 안 보임
- openUIObject가 Inspector에서 연결되었는지 확인
- openUIObject 안에 TMP_Text 컴포넌트가 있는지 확인
- Canvas가 World Space로 설정되었는지 확인

### "cannot set text" 오류
- TMP_Text 컴포넌트를 사용해야 합니다 (UnityEngine.UI.Text 아님)
- openUIObject의 자식에 TextMeshPro - Text (UI) 컴포넌트 추가

### GameFlowManager not found
- Managers 오브젝트 아래에 GameFlowManager가 있는지 확인
- 또는 보따리의 부모 오브젝트에 GameFlowManager가 있는지 확인

## 6. 다음 단계

프롤로그 테스트 완료 후:
1. 타임리프 연출 테스트
2. 도깨비 등장 및 대사 테스트
3. Round 1 (판돌 건너기) 전환 테스트
