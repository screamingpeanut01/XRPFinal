# 판돌 건너기 설정 가이드

> **문서 버전:** 1.0  
> **최종 수정일:** 2024-12-10  
> **관련 스크립트:** `PandolManager.lua`, `PlatformStep.lua`, `GoalZoneTrigger.lua`, `FallZoneTrigger.lua`

---

## 1. 개요

판돌 건너기는 Round 1 게임으로, 플레이어가 두 줄의 발판 중 안전한 발판을 선택하여 끝까지 도달하는 게임입니다.

### 게임 규칙

1. 각 단계마다 좌/우 두 개의 발판이 있음
2. 하나는 **안전**, 하나는 **깨지는** 발판 (랜덤 배치)
3. 플레이어가 깨지는 발판을 밟으면 낙하 → 리스폰
4. 끝까지 도달하면 클리어 → Round 2로 전환

---

## 2. Unity 설정

### 2.1 Hierarchy 구조

```
Area_02_Pandol (영역)
├── VivenLuaBehaviour (PandolManager.lua)
├── SpawnPoint (Transform)
├── Platforms
│   ├── Step_01
│   │   ├── Platform_Left (VivenLuaBehaviour: PlatformStep.lua)
│   │   └── Platform_Right (VivenLuaBehaviour: PlatformStep.lua)
│   ├── Step_02
│   │   ├── Platform_Left
│   │   └── Platform_Right
│   └── ... (Step_03 ~ Step_10)
├── GoalZone (BoxCollider Trigger + VivenLuaBehaviour: GoalZoneTrigger.lua)
├── FallZone (BoxCollider Trigger + VivenLuaBehaviour: FallZoneTrigger.lua)
└── Goblin (선택)
```

### 2.2 PandolManager 설정

| 변수명 | 타입 | 설명 | 필수 |
|--------|------|------|------|
| `gameFlowManagerName` | string | GameFlowManager 이름 | 선택 (기본: "GameFlowManager") |
| `stageManagerName` | string | StageManager 이름 | 선택 |
| `goblinNPCName` | string | GoblinNPC 이름 | 선택 |
| `goblinObject` | GameObject | 도깨비 오브젝트 | 선택 |
| `goalZone` | GameObject | 골 영역 | ✅ 권장 |
| `fallZone` | GameObject | 낙하 감지 영역 | ✅ 권장 |
| `spawnPoint` | GameObject | 리스폰 위치 | ✅ 필수 |
| `leftPlatforms` | GameObject[] | 좌측 발판 배열 | ✅ 필수 |
| `rightPlatforms` | GameObject[] | 우측 발판 배열 | ✅ 필수 |
| `successSound` | AudioSource | 성공 사운드 | 선택 |
| `failSound` | AudioSource | 실패 사운드 | 선택 |
| `startSound` | AudioSource | 시작 사운드 | 선택 |
| `respawnDelay` | number | 리스폰 대기 시간 | 선택 (기본: 2.0) |
| `maxAttempts` | number | 최대 시도 횟수 (0=무제한) | 선택 (기본: 0) |
| `randomizePlatforms` | boolean | 랜덤 배치 활성화 | 선택 (기본: true) |

### 2.3 PlatformStep 설정 (개별 발판)

| 변수명 | 타입 | 설명 | 필수 |
|--------|------|------|------|
| `breakParticle` | ParticleSystem | 깨지는 파티클 | 선택 |
| `breakSound` | AudioSource | 깨지는 사운드 | 선택 |
| `meshRenderer` | MeshRenderer | 발판 메쉬 | 자동 획득 |
| `platformCollider` | Collider | 발판 콜라이더 | 자동 획득 |
| `breakDelay` | number | 깨지기 전 딜레이 | 선택 (기본: 0.3) |
| `isSafePlatform` | boolean | 안전 여부 | PandolManager가 설정 |

### 2.4 GoalZoneTrigger / FallZoneTrigger 설정

| 변수명 | 타입 | 설명 |
|--------|------|------|
| `pandolManagerName` | string | PandolManager 이름 (기본: "PandolManager") |
| `pandolManagerObject` | GameObject | PandolManager 오브젝트 |
| `cooldownTime` | number | (FallZone만) 중복 감지 방지 쿨다운 |

---

## 3. 발판 프리팹 설정

### 3.1 발판 오브젝트 구조

```
Platform_Left (또는 Platform_Right)
├── VivenLuaBehaviour (PlatformStep.lua)
├── MeshFilter + MeshRenderer (발판 외형)
├── BoxCollider (물리 충돌)
├── AudioSource (breakSound)
└── BreakParticle (ParticleSystem)
```

### 3.2 태그 설정

발판은 플레이어와 충돌을 감지하기 위해 **플레이어 오브젝트에 "Player" 태그**가 필요합니다.

---

## 4. 존(Zone) 설정

### 4.1 GoalZone (골 영역)

- **위치:** 마지막 발판 바로 뒤
- **크기:** 플레이어가 충분히 들어올 수 있는 크기
- **컴포넌트:**
  - `BoxCollider` (Is Trigger: ✅)
  - `VivenLuaBehaviour` (GoalZoneTrigger.lua)

### 4.2 FallZone (낙하 영역)

- **위치:** 발판 아래 (Y좌표 -10 정도)
- **크기:** 전체 발판 영역을 커버하는 넓은 평면
- **컴포넌트:**
  - `BoxCollider` (Is Trigger: ✅)
  - `VivenLuaBehaviour` (FallZoneTrigger.lua)

---

## 5. 게임 흐름

### 5.1 시작 시퀀스

```
1. Area_02_Pandol 활성화 (onEnable)
2. PandolManager.StartGame() 호출
3. 발판 리셋 + 랜덤 배치
4. 도깨비 인트로 대사 (GoblinNPC.PlayRound1IntroSequence)
5. "발판을 선택하여 건너세요!" 자막
```

### 5.2 플레이 중

```
- 플레이어가 발판 밟음 (PlatformStep.onCollisionEnter)
  - 안전 발판: 아무 일 없음
  - 깨지는 발판: 파괴 연출 → 플레이어 낙하

- 플레이어 FallZone 진입 (FallZoneTrigger)
  → PandolManager.OnPlayerFall()
  → 실패 메시지 + 리스폰
```

### 5.3 클리어 시퀀스

```
1. 플레이어 GoalZone 진입 (GoalZoneTrigger)
2. PandolManager.OnGoalReached() → OnGameClear()
3. 성공 사운드 + 햅틱 피드백
4. 도깨비 성공 대사
5. GameFlowManager.TransitionToRound2()
```

---

## 6. API 사용법

### 6.1 PandolManager API

```lua
-- 게임 상태 확인
pandolManager.IsGameActive()    -- 게임 활성화 여부
pandolManager.IsGameCleared()   -- 클리어 여부
pandolManager.GetAttemptCount() -- 시도 횟수

-- 게임 제어
pandolManager.StartGame()       -- 게임 시작
pandolManager.StopGame()        -- 게임 중지
pandolManager.RestartGame()     -- 게임 재시작
pandolManager.RespawnPlayer()   -- 플레이어 리스폰

-- 이벤트 (내부 또는 트리거에서 호출)
pandolManager.OnPlayerFall()    -- 플레이어 낙하
pandolManager.OnGoalReached()   -- 골 도달
pandolManager.OnPlatformBreak(platformObj) -- 발판 깨짐
```

### 6.2 PlatformStep API

```lua
-- 상태 확인
platformStep.GetIsSafe()     -- 안전 발판인지
platformStep.IsTriggered()   -- 이미 밟혔는지

-- 설정 (PandolManager가 호출)
platformStep.SetIsSafe(bool)     -- 안전 여부 설정
platformStep.SetManager(manager) -- 매니저 설정
platformStep.ResetPlatform()     -- 발판 리셋
```

---

## 7. 디버깅

### 7.1 로그 확인

```
[PandolManager] Initialized
[PandolManager] Initializing 10 platform steps
[PandolManager] Step 1 safe: LEFT
[PandolManager] Starting Pandol game
[PlatformStep] Player stepped on platform - Safe: true
[PlatformStep] Platform breaking...
[FallZoneTrigger] Player fell!
[PandolManager] Player fell! Attempt: 1
[GoalZoneTrigger] Player reached goal!
[PandolManager] Game cleared!
```

### 7.2 일반적인 문제

| 문제 | 원인 | 해결 방법 |
|------|------|----------|
| 발판이 안 깨짐 | 플레이어 태그 미설정 | Player 태그 설정 |
| 리스폰이 안 됨 | spawnPoint 미설정 | Inspector에서 설정 |
| 랜덤 배치가 안 됨 | leftPlatforms/rightPlatforms 미설정 | 배열 설정 |
| 골 도달해도 반응 없음 | GoalZone 콜라이더 Is Trigger 체크 안 됨 | Is Trigger 활성화 |
| 낙하 감지 안 됨 | FallZone 너무 작음 | 크기 확대 |

---

## 8. 확장 가능 기능

- [ ] 발판 흔들림 힌트 (밟기 전에 약간 흔들림)
- [ ] 시간 제한 모드
- [ ] 발판별 난이도 (뒤로 갈수록 더 빨리 깨짐)
- [ ] 멀티플레이어 지원
- [ ] 리더보드 (최소 시도 횟수 기록)
